<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Android Video Playback made easy."><meta name=author content="2019 Nam Nguyen, nam@ene.im"><link href=https://eneim.github.io/kohii/intro/ rel=canonical><link rel=icon href=../art/favicon.ico><meta name=generator content="mkdocs-1.3.1, mkdocs-material-8.5.3"><title>Intro - Kohii</title><link rel=stylesheet href=../assets/stylesheets/main.7a952b86.min.css><link rel=stylesheet href=../assets/stylesheets/palette.cbb835fc.min.css><meta name=theme-color content=#546d78><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Noto+Sans+JP:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Noto Sans JP";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../css/main.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme data-md-color-primary=blue-grey data-md-color-accent=cyan> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#tl-dr class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title=Kohii class="md-header__button md-logo" aria-label=Kohii data-md-component=logo> <img src=../art/ic_launcher-web.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Kohii </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Intro </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/eneim/kohii title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> Kohii </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title=Kohii class="md-nav__button md-logo" aria-label=Kohii data-md-component=logo> <img src=../art/ic_launcher-web.png alt=logo> </a> Kohii </label> <div class=md-nav__source> <a href=https://github.com/eneim/kohii title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> Kohii </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../glossary/ class=md-nav__link> Glossary </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> Using Kohii <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Using Kohii" data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Using Kohii </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../getting-started/ class=md-nav__link> Getting start </a> </li> <li class=md-nav__item> <a href=../usage-basic/ class=md-nav__link> Basic usages </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3 type=checkbox id=__nav_3_3> <label class=md-nav__link for=__nav_3_3> Advance usages <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Advance usages" data-md-level=2> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> Advance usages </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../advance-summary/ class=md-nav__link> Summary </a> </li> <li class=md-nav__item> <a href=../advance-builder/ class=md-nav__link> Using custom Kohii creators </a> </li> <li class=md-nav__item> <a href=../advance-unique-tag/ class=md-nav__link> Using unique tag </a> </li> <li class=md-nav__item> <a href=../advance-thumbnail/ class=md-nav__link> Show/Hide thumbnail </a> </li> <li class=md-nav__item> <a href=../advance-switch-renderer/ class=md-nav__link> Switching renderers </a> </li> <li class=md-nav__item> <a href=../advance-reuse-renderer-instance/ class=md-nav__link> Reusing renderer </a> </li> <li class=md-nav__item> <a href=../advance-memory-mode/ class=md-nav__link> Using MemoryMode </a> </li> <li class=md-nav__item> <a href=../advance-multiple-playbacks/ class=md-nav__link> Multiple playbacks </a> </li> <li class=md-nav__item> <a href=../advance-manual-playback/ class=md-nav__link> Manual playback (experimental) </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../demos/ class=md-nav__link> Demo app </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4> Extending Kohii <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Extending Kohii" data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Extending Kohii </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../custom-engine/ class=md-nav__link> Custom Engine </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../changelog/ class=md-nav__link> Changelog </a> </li> <li class=md-nav__item> <a href=../api/ class=md-nav__link> API </a> </li> <li class=md-nav__item> <a href=../code_of_conduct/ class=md-nav__link> Code of Conduct </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#tl-dr class=md-nav__link> TL, DR </a> </li> <li class=md-nav__item> <a href=#the-idea-of-playback-continuity class=md-nav__link> The idea of Playback Continuity </a> </li> <li class=md-nav__item> <a href=#features class=md-nav__link> Features </a> <nav class=md-nav aria-label=Features> <ul class=md-nav__list> <li class=md-nav__item> <a href=#0-rich-feature-demo-application class=md-nav__link> 0. Rich feature demo application </a> </li> <li class=md-nav__item> <a href=#1-few-line-setup-full-auto class=md-nav__link> 1. Few-line setup, full auto </a> </li> <li class=md-nav__item> <a href=#2-reusing-playerview-instance-with-the-same-amount-of-code class=md-nav__link> 2. Reusing PlayerView instance, with the same amount of code </a> </li> <li class=md-nav__item> <a href=#3-manual-control class=md-nav__link> 3. Manual control </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/eneim/kohii/edit/master/docs/intro.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg> </a> <h1>Intro</h1> <h2 id=tl-dr>TL, DR<a class=headerlink href=#tl-dr title="Permanent link">&para;</a></h2> <p><strong>Kohii</strong> is a library that:</p> <ul> <li>Is built for Android, supports Android 4.4 (SDK 19) and up.</li> <li>Provides easy to use Video playback functionality, including automatic playback, playback continuity across config change, lifecycle change and more.</li> <li>By default, support ExoPlayer and any ViewGroup as the <em>bucket</em> for videos, including: RecyclerView, NestedScrollView, ViewPager, ViewPager2, general ViewGroup, etc</li> </ul> <p>Kohii provides following features by default:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> Full automatic playback control using ExoPlayer as playback framework.</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> Semi manual playback control using ExoPlayer as playback framework. User can play/pause specific player on demand, Kohii will smartly pause the Video if it is not visible anymore, and restore the previous state later if needed.</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> Full manual playback control using ExoPlayer as playback framework. User can play/pause specific player on demand, Kohii does not touch anything, but take care of cleaning resource if needed (eg: release Player instances after user closes the Application).</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> Preserve <em>playback continuity</em> across configuration changes, lifecycle changes (eg: from Activity to Activity) using ExoPlayer as playback framework. This means: rotating the device, switching to multi-windows mode or opening full-screen player doesn\'t trigger pausing/resuming the playback. While the visual part will be re-rendered (due to View recreation), the audio part is kept smoothly, provide continuous playback experience.</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> Reuse PlayerView instances for many players. Thinking that playing thousands of videos in sequence just using <strong><em>one PlayerView instance</em></strong>.</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> Scoped volume configuration. This means: you can set volume value of one Video, and apply the same for others, depending on the scope you want. The scope can be just that Video, or all Videos <em>in the same RecyclerView/ScrollView</em>, or all Videos <em>in the same Activity</em>.</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> Rich features demo app: demo and guidelines for creating various UX/UI patterns, from simple to complicated, including Picture-In-Picture playback or Scroll-To-Mini-Player UX just like YouTube app.</li> </ul> <p>For advance developers</p> <ul> <li><strong>Kohii</strong> API is highly abstracted. You can easily extend it to support non-ExoPlayer API, or more complicated playback API. There is demo on how to use <a href=https://github.com/PierfrancescoSoffritti/android-youtube-player>this YouTube player library</a> in Kohii.</li> </ul> <h2 id=the-idea-of-playback-continuity>The idea of Playback Continuity<a class=headerlink href=#the-idea-of-playback-continuity title="Permanent link">&para;</a></h2> <p>The concept <em>Playback Continuity</em> comes when I prepared for <a href=https://droidkaigi.jp/2019/timetable/70957/ >the Tokyo DroidKaigi 2019</a> where I will also talk about the same topic. Its idea was in my mind for a long time ago.</p> <p>Thinking about a Video playback, what are the common scenarios:</p> <ul> <li>Single, individual playback, like watching a movie on Netflix or YouTube.</li> <li>Multiple playback, like viewing many videos on a timeline like Facebook, and watch them one by one while scrolling through the list.</li> </ul> <p>All of these scenarios must share some common behaviors:</p> <h2 id=features>Features<a class=headerlink href=#features title="Permanent link">&para;</a></h2> <h4 id=0-rich-feature-demo-application>0. Rich feature demo application<a class=headerlink href=#0-rich-feature-demo-application title="Permanent link">&para;</a></h4> <p>As always, I try to cover as much of the capabilities of the library as possible in the demo app. By that, you can have the recommended ways to implement many patterns using <strong>Kohii</strong>, including:</p> <ul> <li>Using Kohii in RecyclerView only (the simplest pattern).</li> <li>Using Kohii in <em>NestedScrollView</em> only (yes, <strong>Kohii</strong> does not just support RecyclerView, it works with any <em>ViewGroup</em> you can imagine of, or, most of them).</li> <li>Using Kohii in <em>ViewPager</em> only, where each page is a <em>Fragment</em> (this is one of the thing that <strong>toro</strong> could not support well, so Kohii is here for the rescue).</li> <li>Using Kohii in Master/Detail UI composition (this is a new pattern I\'m experimenting with, and it needs time to be battle proof, and it needs your feedback to be mature &lt;3).</li> <li>Using Kohii in RecyclerView, with 'click-to-fullscreen' feature like YouTube UI. This is the game changer, my <strong>selling point for Kohii</strong> &lt;3. Implementation of it is also discussed in <a href=https://ene.im/2019/02/10/droidkaigi-2019-part-4/ >this post</a>.</li> <li>Using Kohii in RecyclerView, with 'click-to-fullscreen' feature that open the fullscreen playback in new <strong>Activity</strong>, <em>without pausing/resuming the playback</em>. So starting new Activity for fullscreen player will not interrupt your playback UX, sounds good huh?</li> <li>Using Kohii in RecyclerView, with 'click-to-fullscreen' feature that open the fullscreen playback in new <strong>Fragment</strong>, because <em>single Activity</em> is the new trend. To make it more fun, I also add the <em>fragment transition learnt from <a href=https://github.com/google/android-transition-examples/tree/master/GridToPager>here</a></em>.</li> <li>And more to come, depending on the feedback I got, request I receive and time I have to spend.</li> </ul> <h4 id=1-few-line-setup-full-auto>1. Few-line setup, full auto<a class=headerlink href=#1-few-line-setup-full-auto title="Permanent link">&para;</a></h4> <p>Thinking that you just need the following lines to integrate fully automatic Video playback in to your App:</p> <div class=highlight><pre><span></span><code><span class=c1>// Init Kohii for Fragment or Activity</span><span class=w></span>
<span class=kd>val</span><span class=w> </span><span class=nv>kohii</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Kohii</span><span class=o>[</span><span class=k>this</span><span class=w> </span><span class=cm>/* fragment or activity instance */</span><span class=o>]</span><span class=w></span>
<span class=n>kohii</span><span class=p>.</span><span class=na>register</span><span class=p>(</span><span class=k>this</span><span class=p>,</span><span class=w> </span><span class=n>arrayOf</span><span class=p>(</span><span class=n>recyclerView</span><span class=p>))</span><span class=w> </span><span class=c1>// register the RecyclerView to be a &#39;host&#39; of our Videos.</span><span class=w></span>

<span class=c1>// In ViewHolder or Adapter&#39;s onBindViewHolder, where kohii instance is passed from above</span><span class=w></span>
<span class=n>kohii</span><span class=p>.</span><span class=na>setUp</span><span class=p>(</span><span class=n>videoUrl</span><span class=p>).</span><span class=na>bind</span><span class=p>(</span><span class=n>playerView</span><span class=p>)</span><span class=w> </span><span class=c1>// playerView is instance of ExoPlayer&#39;s PlayerView.</span><span class=w></span>
</code></pre></div> <p>This is the fastest way to use <strong>Kohii</strong>. With this setup, you got:</p> <ul> <li>Videos will be played/paused automatically on user's scroll.</li> <li>The top-most PlayerView whose visible area is equal to, or more than <strong>65%</strong> of its area will be the one to play, all other PlayerView instances will be paused.</li> <li>Configuration changes like multi-windows mode, orientation change etc will not interupt the playback. (As the matter of fact, SurfaceView or TextureView used in PlayerView will be recreated, so you will see the <em>glitch</em> of the Video image frame, but the Audio will keep playing during the configuration change).</li> </ul> <p>Under the hood:</p> <ul> <li>Resource for Video playback is initialized as late as possible, so there is little to no impact to app's UX.</li> <li>Resource for Video playback is cached for reusability, so playback switching will be as fast as possible.</li> <li>Cached resource will be released as soon as possible, so there is no concern about memory leak.</li> <li>All playback logic, ExoPlayer implementation are provided by Kohii. You don't need to worry about anything.</li> </ul> <p>Digging in the API, you will have more control over the playback behavior, including:</p> <ul> <li>Repeat mode, which is the same with that of ExoPlayer.</li> <li>Delay, which help you to start the Playback with an amount of delay.</li> <li>Visible area of the PlayerView that trigger the playback. It is 65% by default, but you are free to change it.</li> <li>Initial playback info, so you can control the starting position, volume of a playback.</li> <li>And more.</li> </ul> <h4 id=2-reusing-playerview-instance-with-the-same-amount-of-code>2. Reusing PlayerView instance, with the same amount of code<a class=headerlink href=#2-reusing-playerview-instance-with-the-same-amount-of-code title="Permanent link">&para;</a></h4> <p>Yes, you read it correctly. Now you can reuse PlayerView instance across many Video playback. This is something <strong>toro</strong> could not archive, due to the limitation of its design. And as it is <a href=https://github.com/google/ExoPlayer/issues/867>highly requested</a>, <strong>Kohii</strong> is my answer to the problem.</p> <p>Changing the setup before to this</p> <div class=highlight><pre><span></span><code><span class=c1>// Init Kohii for Fragment or Activity</span><span class=w></span>
<span class=kd>val</span><span class=w> </span><span class=nv>kohii</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Kohii</span><span class=o>[</span><span class=k>this</span><span class=w> </span><span class=cm>/* fragment or activity instance */</span><span class=o>]</span><span class=w></span>
<span class=n>kohii</span><span class=p>.</span><span class=na>register</span><span class=p>(</span><span class=k>this</span><span class=p>,</span><span class=w> </span><span class=n>arrayOf</span><span class=p>(</span><span class=n>recyclerView</span><span class=p>))</span><span class=w> </span><span class=c1>// register the RecyclerView to be a &#39;host&#39; of our Videos.</span><span class=w></span>

<span class=c1>// In ViewHolder or Adapter&#39;s onBindViewHolder, where kohii instance is passed from above</span><span class=w></span>
<span class=n>kohii</span><span class=p>.</span><span class=na>setUp</span><span class=p>(</span><span class=n>videoUrl</span><span class=p>).</span><span class=na>bind</span><span class=p>(</span><span class=n>playerViewContainer</span><span class=p>)</span><span class=w> </span><span class=c1>// playerViewContainer is a ViewGroup to put PlayerView instance on demand.</span><span class=w></span>
</code></pre></div> <p>Just changing from using a <strong>PlayerView</strong> instance directly to using a <em>container</em>, you are done. To help you understand this feature, let\'s talk about the <em>why</em> real quick: <em>why reusing PlayerView instance is that cool?</em>.</p> <p>If you take a look on <a href=(https://github.com/google/ExoPlayer/issues/867)>the issue I mention above</a>, go from bottom-up because it is a long issue to read through, you can see the discussion about reusing stuff in the <em>ExoPlayer &amp; RecyclerView combination</em>. Yes, it is important to reuse as much as possible, to keep a smooth user experience, as well as to save memory.</p> <p>Assuming that you use PlayerView in your ViewHolder to play the video. If your viewport has 3 ~ 4 ViewHolders that contains Video, there will be at most one PlayerView that is playing at a time, and at least 2 ~ 3 PlayerView instances doing nothing, but still keeping an expensive <em>Surface object</em> alive. We know that creating and keeping Surface are expensive operations, so reusing the Surface is a reasonable requirement.</p> <p>How <strong>Kohii</strong> supports this: </p> <ul> <li>The required step is client provides the <em>container</em> to Kohii using the code above. The <em>container</em> can be just a FrameLayout.</li> <li>Kohii keeps a pool of <strong>PlayerView</strong> that will create the PlayerView instance on demand, and keep the cache of up to 2 instances of it, in the Activity's <em>lifecycle</em> scope. So once the Activity is destroyed, the pool is automatically cleared, again, no fear of memory leak.</li> <li>Kohii knows <em>when the PlayerView should appear, and when it should not</em>. When the PlayerView is demanded, Kohii acquires one instance from the pool. If there is no cached instance, a new instance will be created. On one hand, this instance will be passed to the playback engine, and on the other hand, it will be added to the <em>container</em> by internal mechanism. When the PlayerView should disappear, Kohii will remove it from the <em>container</em>, and release it back to the pool for reuse.</li> <li>Because there will be at most one PlayerView to play at a time, and Kohii's pool keeps up to 2 instances at a time, there will be at most 2 PlayerView instances living at a moment. (In practice, depends on how complicated your video content is, there will be more. For example you have both DRM content and non-DRM content, and you want to use TextureView for non-DRM ones, then Kohii keeps 2 pools for 2 types of playback).</li> </ul> <p>The caveat of this mechanism is that <em>by default</em> you do not control the way a PlayerView is created (spoiler: with more lines of code, you can).</p> <p>With more advance setup, you have the following control:</p> <ul> <li>How to add and remove PlayerView instance to/from the <em>container</em>. Because your container may contains other Views, Kohii allows you to provide your way to handle this operation.</li> <li>How to create PlayerView instance, because you may have your custom PlayerView implementation.</li> </ul> <h4 id=3-manual-control>3. Manual control<a class=headerlink href=#3-manual-control title="Permanent link">&para;</a></h4> <p>Some of the requirement I got from <strong>toro</strong> are the abilities to:</p> <ul> <li>Manually control the playback using UI/buttons</li> <li>Mute/Un-mute one playback and apply that to all</li> </ul> <p>Those 2 control can be gathered in one group: manual playback control, with scope.</p> <p><strong>Kohii</strong> provides the following behaviors to make it possible:</p> <ul> <li> <p>Allow client to configure so that, user can fully control the video playback, without any help by Kohii. For instance: when your RecyclerView is shown, and the first ViewHolder is a Video and it is fully visible. This behavior will not start the playback automatically, user can start/pause/do anything with the playback using client-provide UI controller. Once user scrolls the Video so that it is no longer visible on screen, Kohii will not do anything to pause or release the playback. If it was playing before, it keeps playing. If it was paused before, it keeps being paused. But once the Activity that contains this playback is destroyed, Kohii will correctly clear any resource in use. And even better, the manual playback is retained across configuration change, without any interuption.</p> </li> <li> <p>Allow client to configure so that, user can control the playback on the fly. This means that: Kohii will still start the playback automatically, but once user click to some buttons to pause it, Kohii will not change that state. So a video paused by user, even if it is fully visible, will not be played automatically (in full-auto config, Kohii will start this playback). When user scrolls the Video so that it is no longer visible enough, Kohii will do its jobs to pause and release resource if needed. And when user scrolls the Video back to visible enough, Kohii will put the playback to its previous state: if it was playing before being scrolled off-screen, it will be resumed; if it was paused before being scrolled off-screen, it keeps being paused.</p> </li> <li> <p>About the volume control, it works in a bit different way: Kohii allows client to apply a volume value by <em>scope</em>. There are 4 scopes in Kohii, but to not go too deep, I will just talk about 2: playback scope, and global scope. If client applies a volume value to <em>playback scope</em>, then only the receiver playback object will have this new volume value. But if client applies a volume value to <em>global scope</em>, then all currently playing playbacks, and any playback that <em>will be created next</em> will have the new volume value. The control flow is easy to imagine, but not easy to implementation. What I did for Kohii is one of my best thing I have ever done. And I hope it helps you to solve your problems.</p> </li> </ul> </article> </div> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2019 Nam Nguyen, nam@ene.im </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/eneim/kohii target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><!-- Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.5bf1dace.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script> <script src=../assets/javascripts/bundle.37e9125f.min.js></script> </body> </html>